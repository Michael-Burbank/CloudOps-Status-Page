include:
  - template: Security/SAST.gitlab-ci.yml
  - template: Security/Secret-Detection.gitlab-ci.yml

variables:
  SECRET_DETECTION_ENABLED: 'true'
  GIT_DEPTH: 0

stages:
  - secret-detection
  - ci
  - test
  - build
  - deploy


github:
  stage: ci
  script:
    - echo "Pushing to GitHub repository..."
    - |
      git config user.name "Michael-Burbank"
      git config user.email "Mike.W.Burbank@Gmail.com"
    - |
      if git remote | grep github; then
        git remote set-url github "https://${GITHUB_TOKEN}@github.com/Michael-Burbank/CloudOps-Status-Page.git"
      else
        git remote add github "https://${GITHUB_TOKEN}@github.com/Michael-Burbank/CloudOps-Status-Page.git"
      fi
    - git checkout -b main || git checkout main
    - git push github main
    - echo "Pushed to GitHub repository."
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
      when: always